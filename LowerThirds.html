<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<style>

body{
  margin:0;
  overflow:hidden;
  background:transparent;
}

#lowerthird{
  position:absolute;
  bottom:0;
  left:0;
  width:100%;
}

#text-wrapper{
  transform:translateX(-100%);
  opacity:0;
}

/* SAME CARBON ANIMATION */

.slide-in{
  animation:slideIn .6s ease forwards;
}

.slide-out{
  animation:slideOut .6s ease forwards;
}

@keyframes slideIn{
  from{
    transform:translateX(-100%);
    opacity:0;
  }
  to{
    transform:translateX(0);
    opacity:1;
  }
}

@keyframes slideOut{
  from{
    transform:translateX(0);
    opacity:1;
  }
  to{
    transform:translateX(-100%);
    opacity:0;
  }
}

</style>
</head>

<body>

<div id="lowerthird">
  <div id="text-wrapper">
    <div id="headline"></div>
    <div id="subline"></div>
  </div>
</div>

<script>

const ENDPOINT_URL =
"https://script.google.com/macros/s/YOUR_ENDPOINT/exec";

const HOLD_DURATION = 6000;
const ANIMATION_DURATION = 600;

const headline =
document.getElementById("headline");

const subline =
document.getElementById("subline");

let lastTimelineIndex = -1;

/* ===============================
   MASTER TIMELINE SYNC
================================ */

async function syncTimeline(){

  try{

    const res = await fetch(
      https://script.google.com/macros/s/AKfycbyz-izL1cT1FGGIXDStm32Fxw_bGfmV_bxrS29J2tlGaUdJytmlZbVDWmlevQJmGI5D/exec + "?t=" + Date.now()
    );

    const data = await res.json();

    const slides = data.lowerThird || [];

    if(!slides.length) return;

    const timelineIndex =
      data.timelineIndex;

    const index =
      timelineIndex % slides.length;

    if(index === lastTimelineIndex)
      return;

    lastTimelineIndex = index;

    const item = slides[index];

    playSlide(item);

  }catch(err){
    console.error("Timeline error",err);
  }
}

/* ===============================
   PLAY SLIDE
================================ */

function playSlide(item){

  const wrapper =
    document.getElementById(
      "text-wrapper"
    );

  headline.textContent =
    item.headline || "";

  subline.textContent =
    item.subline || "";

  /* sync promo screen */
  localStorage.setItem(
    "currentPromo",
    JSON.stringify(item)
  );

  wrapper.className="";
  wrapper.classList.add("slide-in");

  setTimeout(()=>{

    wrapper.classList.remove(
      "slide-in"
    );

    wrapper.classList.add(
      "slide-out"
    );

  }, HOLD_DURATION);
}

/* ===============================
   START SYNC
================================ */

syncTimeline();

/* check master clock */
setInterval(syncTimeline,1000);

</script>

</body>
</html>