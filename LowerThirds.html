<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Carbon Lower Third</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;700&display=swap" rel="stylesheet">

<style>

body{
  margin:0;
  overflow:hidden;
  background:transparent;
  font-family:'Google Sans', Arial, Helvetica, sans-serif;
}

/* ===============================
   TOP BANNER
=============================== */

#banner{
  position:absolute;
  top:0;
  width:100%;
  height:220px;
  overflow:hidden;
}

/* ===============================
   LOOPING BACKGROUND VIDEO
=============================== */

#bgVideo{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  object-fit:cover;
  z-index:1;
  pointer-events:none;
}

/* ===============================
   CONTENT AREA
=============================== */

#content{
  position:absolute;
  top:40px;
  left:80px;
}

/* TEXT */

#text-wrapper{
  position:relative;
  z-index:2;
  color:white;

  margin-left:300px; /* ← PUSH TEXT RIGHT */
}

#headline{
  font-size:50px;
  font-weight:700;
  margin:0;
  line-height:1.1;
}

#subline{
  font-size:36px;
  margin-top:6px;
}

/* ===============================
   WHAT'S ON LOGO (FRONT LAYER)
=============================== */

#whatsOn{
  position:absolute;
  left:-60px;
  top:-15px;
  z-index:3;
  height:100px;
}

/* ===============================
   ANIMATIONS (UNCHANGED)
=============================== */

.slide-in{
  animation:slideIn .6s ease forwards;
}

.slide-out{
  animation:slideOut .6s ease forwards;
}

@keyframes slideIn{
  from{transform:translateX(-100%);opacity:0;}
  to{transform:translateX(0);opacity:1;}
}

@keyframes slideOut{
  from{transform:translateX(0);opacity:1;}
  to{transform:translateX(-100%);opacity:0;}
}

</style>
</head>

<body>

<div id="banner">

  <!-- LOOPING BACKGROUND -->
  <video id="bgVideo" autoplay muted loop playsinline>
    <source src="https://totalmixcreative.github.io/graphics/carbon%20bottom.mp4" type="video/mp4">
  </video>

  <!-- TEXT + LOGO -->
  <div id="content">

      <div id="text-wrapper">
          <div id="headline"></div>
          <div id="subline"></div>
      </div>

      <img id="whatsOn"
      src="https://totalmixcreative.github.io/graphics/whatson.png">

  </div>

</div>

<script>

const ENDPOINT_URL =
"https://script.google.com/macros/s/AKfycbyz-izL1cT1FGGIXDStm32Fxw_bGfmV_bxrS29J2tlGaUdJytmlZbVDWmlevQJmGI5D/exec";

const HOLD_DURATION=6000;
const ANIMATION_DURATION=600;

let items=[];
let index=0;
let rotationStarted=false;
let timelineSynced=false;

  const TOTAL_DURATION =
  HOLD_DURATION + ANIMATION_DURATION;

async function loadData(){
  try{

    const res = await fetch(
      ENDPOINT_URL + "?t=" + Date.now()
    );

    const data = await res.json();

    items = data.lowerThird || [];

    /* ⭐ GLOBAL SYNC POINT */
    if(
      !timelineSynced &&
      items.length &&
      data.timelineIndex !== undefined
    ){
      index =
        data.timelineIndex % items.length;

      timelineSynced = true;
    }

    if(items.length && !rotationStarted){
      rotationStarted = true;
      rotate();
    }

  }catch(err){
    console.error(err);
  }
}

function rotate(){

  if(!items.length)return;

  const item=items[index];
  const wrapper=document.getElementById("text-wrapper");

  headline.textContent=item.headline;
  subline.textContent=item.subline;

  localStorage.setItem(
    "currentPromo",
    JSON.stringify(item)
  );

  wrapper.className="";
  wrapper.classList.add("slide-in");

  setTimeout(()=>{
    wrapper.classList.remove("slide-in");
    wrapper.classList.add("slide-out");
  },HOLD_DURATION);

  setTimeout(()=>{
  wrapper.classList.remove("slide-out");
},HOLD_DURATION+ANIMATION_DURATION);

loadData();
setInterval(loadData,120000);

  let lastIndex = -1;

setInterval(()=>{

  if(!items.length) return;

  const globalIndex =
    Math.floor(
      Date.now() /
      (HOLD_DURATION + ANIMATION_DURATION)
    ) % items.length;

  if(globalIndex !== lastIndex){

    lastIndex = globalIndex;
    index = globalIndex;

    rotate();
  }

},250);

</script>

</body>
</html>


